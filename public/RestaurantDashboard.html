<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/accd26a21f.js" crossorigin="anonymous"></script>
    <title>Swiggy</title>
    <link rel="icon" type="image/x-icon" href="images/Swiggy_logo.png">

    <style>
      
      .navbar span{
        color: #fd7e14;
      }

      #imagelabel{
      
        background-color:  #fd7e14;
        color: #fff;
        padding: 5px;
        border-radius: 5px;
        cursor: pointer;
      }
      .card img:hover{
        transform: scale(0.9);
      }

      .card img{
        transition: transform 0.3s ease-in-out;
      }

      *{
        color: black;
        font-size: medium;
        font-weight:500

      }
    </style>
</head>

<body onload="displayItems()">
    <div id="header">
      <nav class="bg-body-tertiary">
        <div class="d-flex justify-content-between bg-light">
            
            <div class=" p-3">
              <div>
                  <img src="images/Swiggy_logo.png" alt="logo" style="max-width: 60px; float: left;" id="logo">  
                  <button type="button" class="btn d-flex mx-auto" data-bs-toggle="offcanvas" data-bs-target="#left">
                    <span id="restaurantName">Restaurant Name</span> &nbsp; <i class="fa-solid fa-chevron-down" style="color:#fd7e14"></i>
                  </button>
              </div>
                
            <!-- for userdetails off canvass on left side  -->
                
                <div class="offcanvas offcanvas-start" tabindex="-1" id="left" aria-labelledby="left">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="offcanvasExampleLabel">Details</h5>
                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <div class="navbar-nav">
                            <a class="nav-link" href="#">Username: <span id="usernameSpan"></span></a>
                            <a class="nav-link" href="#">Address: <span id="addressSpan"></span></a>
                            <a class="nav-link" href="#">Mobile: <span id="mobileSpan"></span></a>
                            <a class="nav-link" href="#">E-mail: <span id="emailSpan"></span></a>
                            <a class="nav-link" href="#"><button class="btn btn-danger" onclick="logout()">Logout</button></a>
                            <a class="nav-link" href="#">@about Swiggy</a>
                            <a class="nav-link Disabled d-none" href="#"><span id="idSpan"></span></a>
                        </div>
                    </div>
                </div>                        
            </div>

            <div class="pt-3">

                <div class="d-sm-none">
                    <button type="button" class="btn" data-bs-toggle="offcanvas" data-bs-target="#right">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>
                
                <div class="offcanvas-sm offcanvas-end" tabindex="-1" id="right" aria-labelledby="offcanvasExampleLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="offcanvasExampleLabel">Details</h5>
                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" data-bs-target="#right" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <div class="">
                            <a href="search.html"><button class="btn"><i class="fa-solid fa-search"></i> &nbsp; Search</button></a>
                            <a href="#"><button class="btn"><i class="fa-solid fa-percent"></i> &nbsp; Offers</button></a>
                            <a href="support.html"><button class="btn"><i class="fa-solid fa-life-ring"></i> &nbsp; Help</button></a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
      </nav>

    </div>

    <div id="body">

      <h3 class="text-center mt-2  bg-dark p-2" style="color: #fd7e14;"> your food items </h3>
      
      <div class="row m-3 gap-3 d-flex justify-content-center" id="itemsRow">

      </div>
      <!-- div for add Item -->
      <div class="d-flex justify-content-center">
        <div class="text-center bg-light m-3" >
          <div class="">
            <button type="button" class="btn btn-outline-dark mb-1" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo">Add New <img src="https://cdn-icons-png.flaticon.com/512/7130/7130776.png" alt="biryani" style="width: 20px; height: auto"></button>
          </div>
        </div>
      </div>

      <!-- for registration popup div -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Add New food Item</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form>

                <div class="mb-3 text-center" onchange="uploadImageforRegistration()">
                  <div>
                    <img src="" alt="" style="height: 100px; width: auto;" id="photo">

                    <label for="photoSrc" id="imagelabel" class="col-form-label">Choose Photo</label>
                    <input class="form-control d-none" id="photoSrc" type="file" accept="image/*">
                  </div>
                </div>

                <div class="mb-3">
                  <label for="name" class="col-form-label">Name*:</label>
                  <input type="text" class="form-control" id="name" required>
                </div>
                <div class="mb-3">
                  <label for="Price" class="col-form-label">Price*:</label>
                  <input class="form-control" id="Price" required>
                </div>
                <div class="mb-3">
                  <label for="Description" class="col-form-label">Description:</label>
                  <input class="form-control" id="Discription">
                </div>
                
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-success" data-bs-dismiss="modal" onclick="addItem()">Add</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- for edit popup div -->
      <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Edit</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form>

                <div class="mb-3 text-center" onchange="uploadImageforRegistration()">
                  <div>
                    <img src="" alt="" style="height: 100px; width: auto;" id="photo1">

                    <label for="photoSrc" id="imagelabel" class="col-form-label">Choose Photo</label>
                    <input class="form-control d-none" id="photoSrc1" type="file" accept="image/*">
                  </div>
                </div>

                <div class="mb-3">
                  <label for="name" class="col-form-label">Name*:</label>
                  <input type="text" class="form-control" id="name1" required>
                </div>
                <div class="mb-3">
                  <label for="Price" class="col-form-label">Price*:</label>
                  <input class="form-control" id="Price1" required>
                </div>
                <div class="mb-3">
                  <label for="Description" class="col-form-label">Description:</label>
                  <input class="form-control" id="Discription1">
                </div>
                
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-success" data-bs-dismiss="modal" onclick="update()">Update</button>
                </div>

              </form>
            </div>
          </div>
        </div>
      </div>
      


      <span id="currentItemIdSpan" class="d-none"></span>
    </div>

    
    <script>

      function addItem(){
        const newItem = {
          restaurant: document.getElementById("restaurantName").innerText,
          email: document.getElementById("emailSpan").innerHTML,
          dishName: document.getElementById("name").value.toLowerCase(),
          price: document.getElementById("Price").value,
          discription: document.getElementById("Discription").value,
          pic: document.getElementById('photo').src
        }
        
        fetch("http://localhost:3000/postItem",{
          method: "POST",
          headers: {'Content-Type': 'application/json'},  
          body: JSON.stringify(newItem),
           
        })
        .then(response => {
          if (response.ok) {
              alert("New Item added successfully")
              window.location.reload()           
          }
        }) 

      }

      function uploadImageforRegistration(){
        var input = document.getElementById('photoSrc');
        var image = document.getElementById('photo');
        var file = input.files[0];
    
        if (file) {
          image.src = URL.createObjectURL(file);
          const reader = new FileReader();

          reader.onload = function(e) {
              const imageDataUri = e.target.result;
              image.src = imageDataUri
          };

          reader.readAsDataURL(file);
        }
      }

      function displayItems(){
        var email = localStorage.getItem("restaurantMail")

        fetch("http://localhost:3000/restaurant/"+email)
        .then(res => res.json())
        .then(data => {

          document.getElementById("restaurantName").innerText = data.name 
          document.getElementById("usernameSpan").innerText = data.username 
          document.getElementById("addressSpan").innerText = data.address 
          document.getElementById("mobileSpan").innerText = data.mobile 
          document.getElementById("emailSpan").innerText = data.email 
          document.getElementById("idSpan").innerText = data._id
          
        })

        fetch("http://localhost:3000/items/"+email)
        .then(res => res.json())
        .then(data => {

          data.map((item)=>{
            var cardDiv = document.createElement('div')
            cardDiv.className = "card col col-11 col-sm-5 col-md-5 col-lg-3 bg-light text-dark p-2"

            var cardImage = document.createElement("img")
            cardImage.src = item.pic
            cardImage.className = "card-img-top"
            cardImage.style.height = "200px"
            cardDiv.append(cardImage)

            var cardBody = document.createElement("div")
            cardBody.className="card-body"

            var cardDetails = document.createElement("div")
            cardDetails.className = "card-text"

            var star = document.createElement("i")
            star.className = "fa-solid fa-star text-success"

            var nameTag = document.createElement("h6")
            nameTag.className = "cardNameTag fs-4 fw-bold"
            nameTag.innerText = item.dishName 
            nameTag.append(star)
            cardDetails.append(nameTag)

            var moreDiv1 = document.createElement("div")
            moreDiv1.className = "dropstart"

            var moreBtn = document.createElement("button")
            moreBtn.innerText = "⋮"
            moreBtn.className = "btn text-end"
            moreBtn.addEventListener("click", settingItemId)
            moreBtn.setAttribute("data-bs-toggle","dropdown")
            moreBtn.setAttribute("aria-expanded","false")

            var moreDiv = document.createElement("div")
            moreDiv.className = "dropdown-menu"

            var editBtn = document.createElement("button")
            editBtn.className = "btn btn-sm dropdown-item"
            editBtn.innerText = "Edit"
            editBtn.setAttribute("data-bs-toggle","modal")
            editBtn.setAttribute("data-bs-target","#editModal")
            editBtn.setAttribute("data-bs-whatever","@mdo")
            editBtn.addEventListener("click", Edit)

            var delBtn = document.createElement("button")
            delBtn.className = "btn btn-sm dropdown-item"
            delBtn.innerText = "Remove"
            delBtn.addEventListener("click", Del)

            moreDiv.append(editBtn, delBtn)

            moreDiv1.append(moreBtn, moreDiv)
            
            // cardDetails.append(moreBtn)

            var priceTag = document.createElement("div")
            priceTag.className = "fs-6 fw-normal"
            priceTag.innerText = "Price: " + item.price + '/-'

            cardDetails.append(priceTag)

            var descriptionTag = document.createElement("div")
            descriptionTag.className = "fs-6 fw-normal d-flex justify-content-between"
            descriptionTag.innerText = item.discription

            var itemIdSpan = document.createElement("span")
            itemIdSpan.innerText = item._id
            item.id = "itemIdSpan"
            itemIdSpan.className = "d-none"

            descriptionTag.append(itemIdSpan , moreDiv1)

            cardDetails.append(descriptionTag)
            
            cardBody.append(cardDetails)

            cardDiv.append(cardBody)
            document.getElementById("itemsRow").append(cardDiv)

          })
        })
      }

      function Edit(Element){
        
        var element = Element.target.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement
        
        document.getElementById("photo1").src = element.getElementsByTagName("img")[0].src
        document.getElementById("name1").value = element.getElementsByClassName("cardNameTag")[0].innerText
        document.getElementById("Price1").value = element.getElementsByClassName("fs-6")[0].innerText.split(" ")[1].split("/")[0]
        document.getElementById("Discription1").value = element.getElementsByClassName("fs-6")[1].innerText.split("⋮")[0]
        
      }

      function update(){

        var id = document.getElementById("currentItemIdSpan").innerText

        const newItem = {
          restaurant: document.getElementById("restaurantName").innerText,
          email: document.getElementById("emailSpan").innerHTML,

          dishName: document.getElementById("name1").value.toLowerCase(),
          price: document.getElementById("Price1").value,
          discription: document.getElementById("Discription1").value,
          pic: document.getElementById('photo1').src
        }
        
        fetch("http://localhost:3000/updateItem/"+id,{
          method: "PATCH",
          body: JSON.stringify(newItem),
          headers: {'Content-Type': 'application/json'},   
        })

        .then(response => {
          console.log(response)
          if (response.ok) {
              alert("Item updated successfully")
              window.location.reload()

          }else{
            
          }
        })
        
      }
      function Del(){
        var id = document.getElementById("currentItemIdSpan").innerText

        fetch("http://localhost:3000/delItems/"+id,{
          method: "DELETE",
        })
        .then(response => {
          if (response.ok) {
            alert("item Removed")
            window.location.reload()

          }
        })

      }
      function settingItemId(Element){
        var element = Element.target.parentElement.parentElement

        document.getElementById("currentItemIdSpan").innerText = element.getElementsByClassName("d-none")[0].innerText

      }

      function logout(){
        localStorage.removeItem("restaurantMail")
        window.location.href = "RestaurantLogin.html"
      }


    </script>
    
</body>
</html>