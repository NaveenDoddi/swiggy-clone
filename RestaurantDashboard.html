<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/accd26a21f.js" crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" href="home.css"> -->
    <title>Swiggy</title>

    <style>
      
      .navbar span{
        color: #fd7e14;
      }

      #imagelabel{
      
        background-color:  #fd7e14;
        color: #fff;
        padding: 5px;
        border-radius: 5px;
        cursor: pointer;
      }
      .card img:hover{
        transform: scale(0.9);
      }

      .card img{
        transition: transform 0.3s ease-in-out;
      }

      *{
        color: black;
        font-size: medium;
        font-weight:500

      }
    </style>
</head>
<body onload="displayItems()">
    <div id="header">
        <nav class="navbar" style="background-color: #fd7e14;">
            <div class="container-fluid">
              <!-- <a class="navbar-brand" href="#">Swiggy</a> -->
              <img class="navbar-brand" src="images/Swiggy_logo.png" alt="logo" style="max-width: 50px;">
              <span  id="restaurantName" class="fs-1 fw-bolder text-light">Restaurantname</span>
              <!-- Button for toggling the offcanvas menu -->
              <button class="navbar-toggler btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                <span class="navbar-toggler-icon"></span>
              </button>
              
              <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Details</h5>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <div class="navbar-nav">
                        <a class="nav-link" href="#">Username: <span id="usernameSpan"></span></a>
                        <a class="nav-link" href="#">Address: <span id="addressSpan"></span></a>
                        <a class="nav-link" href="#">Mobile: <span id="mobileSpan"></span></a>
                        <a class="nav-link" href="#">E-mail: <span id="emailSpan"></span></a>
                        <a class="nav-link" href="#"><button class="btn btn-danger" onclick="logout()">Logout</button></a>
                        <a class="nav-link" href="#">@about Swiggy</a>
                        <a class="nav-link Disabled d-none" href="#"><span id="idSpan"></span></a>
                    </div>
                </div>
              </div>

            </div>
        </nav>
    </div>

    <div id="body">

      <h3 class="text-center mt-2  bg-dark p-2" style="color: #fd7e14;"> your food items </h3>
      
      <div class="row m-3 gap-3 d-flex justify-content-center" id="itemsRow">

      </div>
      <!-- div for add Item -->
      <div class="d-flex justify-content-center">
        <div class="text-center bg-light m-3" >
          <div class="">
            <button type="button" class="btn btn-outline-dark mb-1" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo">Add New <img src="https://cdn-icons-png.flaticon.com/512/7130/7130776.png" alt="biryani" style="width: 20px; height: auto"></button>
          </div>
        </div>
      </div>

      <!-- for registration popup div -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Add New food Item</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form>

                <div class="mb-3 text-center" onchange="uploadImageforRegistration()">
                  <div>
                    <img src="" alt="" style="height: 100px; width: auto;" id="photo">

                    <label for="photoSrc" id="imagelabel" class="col-form-label">Choose Photo</label>
                    <input class="form-control d-none" id="photoSrc" type="file" accept="image/*">
                  </div>
                </div>

                <div class="mb-3">
                  <label for="name" class="col-form-label">Name*:</label>
                  <input type="text" class="form-control" id="name" required>
                </div>
                <div class="mb-3">
                  <label for="Price" class="col-form-label">Price*:</label>
                  <input class="form-control" id="Price" required>
                </div>
                <div class="mb-3">
                  <label for="Description" class="col-form-label">Description:</label>
                  <input class="form-control" id="Discription">
                </div>
              </form>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-success" onclick="addItem()">Add</button>
            </div>
          </div>
        </div>
      </div>
      
    </div>
    
    <script>

      function addItem(){

        var id = document.getElementById("idSpan").innerText
        
        var item = {
          dishName: document.getElementById("name").value,
          Price: document.getElementById("Price").value,
          Description: document.getElementById("Discription").value,
          pic: document.getElementById('photo').src
        }

        fetch("http://localhost:3000/restaurants/"+id)
        .then(res => res.json())
        .then((data) => {
          data.items.push(item)
          fetch("http://localhost:3000/restaurants/"+id,{
            method: "PATCH",
            body: JSON.stringify({ items: data.items }),
            headers: {'Content-Type': 'application/json'}
          })
          
        })
        
      }

      function uploadImageforRegistration(){
        var input = document.getElementById('photoSrc');
        var image = document.getElementById('photo');
        var file = input.files[0];
    
        if (file) {
          image.src = URL.createObjectURL(file);
          const reader = new FileReader();

          reader.onload = function(e) {
              const imageDataUri = e.target.result;
              image.src = imageDataUri
          };

          reader.readAsDataURL(file);
        }
      }

      function displayItems(){
        var userMail = localStorage.getItem("restaurantMail")

        fetch("http://localhost:3000/restaurants?email="+userMail)
        .then(res => res.json())
        .then(data => {

          document.getElementById("restaurantName").innerText = data[0].restaurant 
          document.getElementById("usernameSpan").innerText = data[0].username 
          document.getElementById("addressSpan").innerText = data[0].address 
          document.getElementById("mobileSpan").innerText = data[0].mobile 
          document.getElementById("emailSpan").innerText = data[0].email 
          document.getElementById("idSpan").innerText = data[0].id

          data[0].items.map((item)=>{
            var cardDiv = document.createElement('div')
            cardDiv.className = "card col col-11 col-sm-5 col-md-5 col-lg-3 bg-light text-dark p-2"

            var cardImage = document.createElement("img")
            cardImage.src = item.pic
            cardImage.className = "card-img-top"
            cardImage.style.height = "200px"
            cardDiv.append(cardImage)

            var cardBody = document.createElement("div")
            cardBody.className="card-body"

            var cardDetails = document.createElement("div")
            cardDetails.className = "card-text"

            var star = document.createElement("i")
            star.className = "fa-solid fa-circle text-success"

            var nameTag = document.createElement("h6")
            nameTag.className = "cardNameTag fs-4 fw-bold"
            nameTag.innerText = item.dishName 
            nameTag.append(star)
            cardDetails.append(nameTag)

            var priceTag = document.createElement("div")
            priceTag.className = "fs-6 fw-normal"
            priceTag.innerText = "Price: " + item.Price + '/-'

            cardDetails.append(priceTag)

            var descriptionTag = document.createElement("div")
            descriptionTag.className = "fs-6 fw-normal"
            descriptionTag.innerText = item.Description +', ' + data[0].address
            cardDetails.append(descriptionTag)

            
            cardBody.append(cardDetails)

            cardDiv.append(cardBody)
            document.getElementById("itemsRow").append(cardDiv)

          })
        })
      }

      function logout(){
        localStorage.removeItem("restaurantMail")
        console.log("lsdkf")
        window.location.href = "restaurantLogin.html"
      }


    </script>
    
</body>
</html>